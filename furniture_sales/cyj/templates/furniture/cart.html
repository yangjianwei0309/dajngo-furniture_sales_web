<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>我的购物车</title>
    <script type="text/javascript" src="/static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/static/js/jquery.min.js"></script>
    <script type="text/javascript" src="/static/js/script.js"></script>
    <link type="text/css" href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link type="text/css" href="/static/css/style.css" rel="stylesheet">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <style>
        * {
            margin: 5px;
            padding: 5px;
        }
    </style>
</head>
<body>
<h3>我的购物车</h3>
<div id="address">
    <table id="detail">
        <tr>
            <td><b>姓名</b></td>
            <td><b>手机号</b></td>
            <td><b>详细地址</b></td>
        </tr>
        <tr>
            <td>{{ address.name }}</td>
            <td>{{ address.phone }}</td>
            <td>{{ address.address_detail }}</td>
        </tr>
    </table>
</div>
<table>
    {% for cart in carts %}
        <tr>
            <td>
                <div class="confirm">
            <span class="isChose">
                <span id="{{ cart.id }}">
                    {% if cart.isSelected %}
                        √
                    {% endif %}
                </span>
            </span>
                </div>
            </td>
            <td><img src="/static/images/wofang/{{ cart.goods.img }}"></td>
            <td>{{ cart.goods.content }}</td>
            <td>{{ cart.goods.price }}</td>
            <td>
                <button>-</button>
            </td>
            <td><b>{{ cart.cnt }}</b></td>
            <td>
                <button>+</button>
            </td>
        </tr>
    {% endfor %}
</table>
<div>
    <div class="confirm">
        <span id="allChose">
            <span></span>
        </span>
    </div>
</div>
<span>总价格 ：</span>
<p id="totalPrice">{{ totalPrice }} </p>
<hr>
<br/><br/>
</body>
</html>

<script>
    $(function () {
        // 是否选择购买的span添加点击事件
        $('.isChose').click(function () {
            // 获取当前Element的第一个子控件
            var spanChild = $(this).children().first();
            var id = spanChild.attr('id');
            if (spanChild.text().trim() == '') {
                spanChild.text('√'); // 选择
                console.log("选择",id);
            } else {
                spanChild.text(''); // 取消选择
                console.log("取消选择",id);
            }
            $.getJSON('/index/select/' + id + '/', function (data) {
                console.log(data);
                // 选择购物车总价格Element


                if (data.status == 200) {
                    var tp = $('#totalPrice').text().trim();
                    // console.log(tp);
                    if (data.selected) {
                        // 选择
                        $("#totalPrice").text((parseFloat(tp)) + (data.price));
                    }else{
                       // 取消选择
                        $("#totalPrice").text((parseFloat(tp)) - (data.price));
                    }
                }
            });
        })

        $('#allChose').click(function () {
            var span = $(this).children().first();
            var str = '';
            if (span.text().trim() == ""){
            // 全部选择
                span.text('√');
                $('.isChose:first-child').text('√');
                str = 'all'
        }else{
                span.text('');
                $('.isChose:first-child').text('');
                str = 'allnot'
            }

            // 更新后台
            $.getJSON('/index/allselect/'+str+'/',function (data) {
                // data = {allSelected:false,price:0}
                    $('#totalPrice').text(data.price);
            })
        })
    })
</script>